name: Build Book

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    container: iksnae/book-builder:latest

    steps:
    - uses: actions/checkout@v4

    # Install the book-tools CLI
    - name: Set up environment
      run: |
        # Install book-tools CLI
        npm install -g iksnae/book-tools
        
        # Verify installation
        book --version
        
        # Debug directory structure
        echo "=== Directory Structure ==="
        ls -la
        echo "=== Book Directory ==="
        ls -la book/
        echo "=== English Directory ==="
        ls -la book/en/
        echo "=== Chapter 1 Directory ==="
        ls -la book/en/chapter-01/

    # Build the book for all languages
    - name: Build book
      run: |
        # Set verbose mode for detailed logging
        export VERBOSE=true
        
        # Build for all languages using the CLI
        book build --all-languages --verbose

    # Upload build artifacts
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: book-builds
        path: build/