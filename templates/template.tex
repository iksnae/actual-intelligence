\documentclass[12pt,a4paper]{book}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{setspace}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{pdflscape}
\usepackage{textcomp}
\usepackage{caption}
\usepackage{etoolbox}
\usepackage{wallpaper}

% Fix for footnotes in tables
\usepackage{footnote}
\makesavenoteenv{longtable}
\makesavenoteenv{table}

% Additional packages for handling large documents
\usepackage{etex}

% Define the missing tightlist command that pandoc expects
\providecommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Define colors
\definecolor{titlecolor}{RGB}{41, 128, 185} % Blue
\definecolor{sectioncolor}{RGB}{52, 152, 219} % Lighter blue
\definecolor{versioncolor}{RGB}{100, 100, 100} % Gray

% Set page geometry
\geometry{margin=1in}

% IMPORTANT: Always start sections on a new page
\let\oldsection\section
\renewcommand{\section}[1]{\clearpage\oldsection{#1}}

% IMPORTANT: Always start subsections with extra space
\let\oldsubsection\subsection
\renewcommand{\subsection}[1]{\vspace{1cm}\oldsubsection{#1}}

% Configure section formatting
\titleformat{\chapter}[display]{\normalfont\huge\bfseries\color{titlecolor}}{\chaptertitlename\ \thechapter}{20pt}{\Huge}
\titleformat{\section}{\normalfont\Large\bfseries\color{sectioncolor}}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\large\bfseries}{\thesubsection}{1em}{}

% Add more space between paragraphs
\setlength{\parskip}{0.5em}

% Commands for new pages after sections and subsections
\newcommand{\sectionbreak}{\clearpage}
\newcommand{\activitybreak}{\clearpage}

% Define version and build date
\newcommand{\bookversion}{VERSION}
\newcommand{\builddate}{BUILDDATE}

% Configure headers and footers
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{Actual Intelligence}
\fancyhead[RE,LO]{\leftmark}
\fancyfoot[C]{\thepage}
\fancyfoot[R]{\textcolor{versioncolor}{\footnotesize{v\bookversion}}}

% Add a footer rule
\renewcommand{\footrulewidth}{0.4pt}

% Plain style for chapter pages
\fancypagestyle{plain}{%
  \fancyhf{}
  \fancyfoot[C]{\thepage}
  \fancyfoot[R]{\textcolor{versioncolor}{\footnotesize{v\bookversion}}}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0.4pt}
}

% Title page information
\title{\Huge Actual Intelligence\\\large A Practical Guide to Using AI in Everyday Life}
\author{Open Source Community}
\date{\builddate}

% Custom commands for cover image handling
$if(cover-image)$
\newcommand{\coverimage}{$cover-image$}
\newcommand{\makecovertitle}{
  \begin{titlepage}
    \centering
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{\coverimage}
    % The title page is the cover image
  \end{titlepage}
  \newpage
  \thispagestyle{empty}
  \begin{center}
    \vspace*{2cm}
    {\Huge \textbf{Actual Intelligence}}\par
    \vspace{1cm}
    {\Large A Practical Guide to Using AI in Everyday Life}\par
    \vspace{2cm}
    {\large Open Source Community}\par
    \vspace{1cm}
    {\large \builddate}\par
    \vspace{1cm}
    {\large Version \bookversion}\par
  \end{center}
  \newpage
}
$else$
\newcommand{\makecovertitle}{
  \maketitle
}
$endif$

\begin{document}

$if(title)$
\makecovertitle
$endif$

$if(toc)$
\tableofcontents
\clearpage
$endif$

$body$

\end{document}