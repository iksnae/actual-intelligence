\documentclass[12pt,a4paper]{book}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage{setspace}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{pdflscape}
\usepackage{textcomp}
\usepackage{caption}
\usepackage{etoolbox}
\usepackage{wallpaper}
\usepackage{ragged2e}
\usepackage{microtype}
\usepackage{hyphenat}

% Fix for footnotes in tables
\usepackage{footnote}
\makesavenoteenv{longtable}
\makesavenoteenv{table}

% Additional packages for handling large documents
\usepackage{etex}

% Define the missing tightlist command that pandoc expects
\providecommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Define colors
\definecolor{titlecolor}{RGB}{41, 128, 185} % Blue
\definecolor{sectioncolor}{RGB}{52, 152, 219} % Lighter blue

% Set page geometry
\geometry{margin=1in}

% Set default alignment to ragged right (left-aligned)
\raggedright
\RaggedRight

% Enable hyphenation for cleaner edges in columns
\hyphenpenalty=50
\tolerance=1000

% Configure multicol for newspaper-style layouts with proper hyphenation
\usepackage{multicol}
\setlength{\columnsep}{1cm}

% IMPORTANT: Always start sections on a new page
\let\oldsection\section
\renewcommand{\section}[1]{\oldsection{#1}}

% IMPORTANT: Always start subsections with extra space
\let\oldsubsection\subsection
\renewcommand{\subsection}[1]{\vspace{1cm}\oldsubsection{#1}}

% Configure section formatting
\titleformat{\chapter}[display]{\normalfont\huge\bfseries\color{titlecolor}}{\chaptertitlename\ \thechapter}{20pt}{\Huge}
\titleformat{\section}{\normalfont\Large\bfseries\color{sectioncolor}}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\large\bfseries}{\thesubsection}{1em}{}

% Add more space between paragraphs
\setlength{\parskip}{0.5em}

% Commands for new pages after sections and subsections
\newcommand{\sectionbreak}{\clearpage}
\newcommand{\activitybreak}{\clearpage}

% Define version and build date placeholders (will not be displayed)
\newcommand{\bookversion}{VERSION}
\newcommand{\builddate}{BUILDDATE}

% Configure clean page style with no headers or footers
\pagestyle{empty}

% Title page information
\title{\Huge Actual Intelligence\\\large A Practical Guide to Using AI in Everyday Life}
\author{K Mills}
\date{\builddate}

% Custom commands for cover image handling
$if(cover-image)$
\newcommand{\coverimage}{$cover-image$}
\newcommand{\makecovertitle}{
  \begin{titlepage}
    \centering
    \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{\coverimage}
    % The title page is the cover image
  \end{titlepage}
  \newpage
  \thispagestyle{empty}
  \begin{center}
    \vspace*{2cm}
    {\Huge \textbf{Actual Intelligence}}\par
    \vspace{1cm}
    {\Large A Practical Guide to Using AI in Everyday Life}\par
    \vspace{2cm}
    {\large K Mills}\par
    \vspace{1cm}
  \end{center}
  \newpage
}
$else$
\newcommand{\makecovertitle}{
  \maketitle
}
$endif$

% Configure listings package for code blocks
\definecolor{codebg}{rgb}{0.95,0.95,0.95}
\definecolor{codeframe}{rgb}{0.8,0.8,0.8}
\definecolor{codecomment}{rgb}{0.5,0.5,0.5}
\definecolor{codestring}{rgb}{0.2,0.6,0.2}
\definecolor{codekeyword}{rgb}{0.2,0.2,0.8}

\lstset{
  basicstyle=\ttfamily\small,
  backgroundcolor=\color{codebg},
  frame=single,
  framesep=3pt,
  rulecolor=\color{codeframe},
  xleftmargin=5pt,
  xrightmargin=5pt,
  breaklines=true,
  breakatwhitespace=false,
  captionpos=b,
  keepspaces=true,
  numbers=left,
  numbersep=5pt,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=2,
  commentstyle=\color{codecomment},
  stringstyle=\color{codestring},
  keywordstyle=\color{codekeyword}\bfseries
}

% Additional setup for inline code
\newcommand{\code}[1]{\texttt{#1}}

\begin{document}

$if(title)$
\makecovertitle
$endif$

$if(toc)$
\tableofcontents
\clearpage
$endif$

$body$

\end{document}